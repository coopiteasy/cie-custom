<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <template id="report_delivery_document" inherit_id="stock.report_delivery_document">
        <!-- sorry for the dark xpath magic, Odoo SA does not name its html element -->


        <!-- picking in state done -->
        <!-- add column headers for price, tax and total -->
        <xpath expr="//th[@name='th_sml_product']/../th[last()]" position="after">
            <t t-if="o.picking_type_code == 'outgoing'">
                <th>
                    <strong>Unit Price</strong>
                </th>
                <th>
                    <strong>Taxes</strong>
                </th>
                <th>
                    <strong>Total</strong>
                </th>
            </t>
        </xpath>

        <!--  add product description to product name-->
        <xpath expr="//span[@t-field='move.product_id']" position="after">
            <span t-field="move.product_id.description_sale" />
        </xpath>


        <!-- picking in state _not_ done -->
        <!-- add column headers for price, tax and total -->
        <xpath
            expr="//tr[@t-foreach='lines']/../../thead/tr/th[last()]"
            position="after"
        >
            <t t-if="o.picking_type_code == 'outgoing'">
                <th>
                    <strong>Unit Price</strong>
                </th>
                <th>
                    <strong>Taxes</strong>
                </th>
                <th>
                    <strong>Total</strong>
                </th>
            </t>
        </xpath>

        <!-- add td for price, tax and total -->
        <xpath expr="//tr[@t-foreach='lines']/td[last()]" position="after">
            <t t-if="o.picking_type_code == 'outgoing'">
                <t t-set="order_line" t-value="move.order_line_id" />
                <td>
                    <span t-field="order_line.price_unit" />
                </td>
                <td>
                    <span t-field="order_line.tax_id.name" />
                </td>
                <td>
                    <span t-field="order_line.price_subtotal" />
                </td>
            </t>
        </xpath>


        <!-- add price and taxes summary table  -->
        <xpath expr="//table[last()]" position="after">
            <t t-if="o.picking_type_code == 'outgoing'">
                <t t-set="sale_order" t-value="o.sale_order_id" />
                <div class="row justify-content-end" name="total">
                    <div
                        t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ms-auto"
                    >
                        <table
                            class="table table-sm table-borderless"
                            style="page-break-inside: avoid;"
                        >
                            <tr class="border-black">
                                <td>
                                    <strong>Total Without Taxes</strong>
                                </td>
                                <td class="text-center">
                                    <span t-field="sale_order.amount_untaxed" />
                                </td>
                            </tr>
                            <tr>
                                <td>Taxes</td>
                                <td class="text-center">
                                    <span t-field="sale_order.amount_tax" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Total</strong>
                                </td>
                                <td class="text-center">
                                    <span t-field="sale_order.amount_total" />
                                </td>
                            </tr>
                            <tr class="border-black">
                                <td>
                                    <strong>Volume (m3)</strong>
                                </td>
                                <td class="text-center">
                                    <span t-field="o.volume" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </t>
        </xpath>

    </template>
</odoo>
